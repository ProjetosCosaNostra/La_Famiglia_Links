# ============================================
# üé© COSA NOSTRA ‚Äî PUBLICADOR OFICIAL (Vers√£o Estendida)
# Projeto: La Famiglia Links
# Autor: O Capo da Cria√ß√£o (Felipe)
# ============================================

# 1Ô∏è‚É£ Garantir que o script pare em caso de erro
$ErrorActionPreference = "Stop"

# 2Ô∏è‚É£ Configurar usu√°rio do Git
git config --global user.name "O Capo da Cria√ß√£o"
git config --global user.email "projetoscosanostra@gmail.com"

# 3Ô∏è‚É£ Inicializar reposit√≥rio (caso ainda n√£o exista)
if (!(Test-Path ".git")) {
    git init
}

# 4Ô∏è‚É£ Criar/atualizar README.md com o estilo da Fam√≠lia
@"
# üé© La Famiglia Links ‚Äî Cosa Nostra

**O painel central da Fam√≠lia das Ideias.**

Re√∫ne os projetos, produtos e conex√µes que mant√™m a *Fam√≠lia Cosa Nostra* unida pela:
> **Fam√≠lia, Honra, Respeito e Palavra.**

---

### üîó Acesse o painel online:
[https://projetoscosanostra.github.io/La_Famiglia_Links/](https://projetoscosanostra.github.io/La_Famiglia_Links/)

---

### üß± Estrutura
- **/data** ‚Üí Configura√ß√µes e informa√ß√µes da Fam√≠lia  
- **/assets** ‚Üí Logos, imagens e √≠cones oficiais  
- **/docs** ‚Üí Roteiros e documentos internos  
- **/logs** ‚Üí Registros de publica√ß√£o  

---

### ‚ôüÔ∏è Sobre a Cosa Nostra
> ‚ÄúFam√≠lia, honra, respeito e palavra. No fim, √© s√≥ isso que fica.‚Äù

üé© *Cosa Nostra ‚Äî A Fam√≠lia das Ideias*  
üß† Criado por **Felipe**, *O Capo da Cria√ß√£o*

---
"@ | Out-File -Encoding utf8 "README.md"

# 5Ô∏è‚É£ Criar mensagem do commit
$mensagemCommit = "Publicacao automatica - $(Get-Date -Format 'dd/MM/yyyy HH:mm')"

# 6Ô∏è‚É£ Adicionar e comitar altera√ß√µes
git add .
git commit -m "$mensagemCommit"

# 7Ô∏è‚É£ Conectar ao reposit√≥rio remoto
git remote remove origin 2>$null
git remote add origin https://github.com/ProjetosCosaNostra/La_Famiglia_Links.git

# 8Ô∏è‚É£ Definir o branch principal e enviar
git branch -M main
git push -u origin main

# 9Ô∏è‚É£ Atualizar descri√ß√£o e homepage do reposit√≥rio
gh repo edit --description "O painel central da Fam√≠lia ‚Äî links, projetos e conex√µes criativas üé©‚ôüÔ∏è"
gh repo edit --homepage "https://projetoscosanostra.github.io/La_Famiglia_Links/"

# üîü Publicar automaticamente no GitHub Pages
# (usando a branch main e o diret√≥rio raiz do projeto)
Write-Host "üïí Publicando site no GitHub Pages..."
git subtree split --prefix . -b gh-pages 2>$null
git push -f origin gh-pages:gh-pages
git branch -D gh-pages 2>$null
Write-Host "‚úÖ Deploy no GitHub Pages conclu√≠do!"

# 11Ô∏è‚É£ Criar registro no log interno
if (!(Test-Path "logs")) {
    New-Item -ItemType Directory -Path "logs" | Out-Null
}
$logPath = "logs/publicacao.txt"
$linhaLog = "[{0}] - {1}" -f (Get-Date -Format "dd/MM/yyyy HH:mm:ss"), $mensagemCommit
Add-Content -Path $logPath -Value $linhaLog

# ‚úÖ Mensagem final de sucesso
Write-Host "============================================"
Write-Host "üé© Publicacao concluida com sucesso, Capo!"
Write-Host "Site online em: https://projetoscosanostra.github.io/La_Famiglia_Links/"
Write-Host "Registro salvo em: logs/publicacao.txt"
Write-Host "============================================"
